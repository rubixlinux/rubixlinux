# Maintainer: Joshua Rubin <joshua@rubix-os.org>

pkgname=glut
pkgver=3.7
pkgrel=1
pkgdesc="glut (3D graphics library) GLUT is a 3D graphics library which uses the OpenGL API. Some 3D programs might need this to run or compile."
url="http://www.opengl.org/resources/libraries/glut.html"
depends=('gcc' 'x11')
source=(http://www.opengl.org/resources/libraries/$pkgname/$pkgname-$pkgver.tar.gz	\
	$pkgname.i486i686.diff.gz							\
	$pkgname.solink.diff.gz								)
md5sums=('dc932666e2a1c8a0b148a4c32d111ef3' \
	 '0bd8049b746f654e419ab465e5f3cc87' \
	 '67bd49a63254ecec8c535d0174930ea4' )

build() {

	cd $startdir/src/$pkgname-$pkgver

	patch -p1 < $startdir/src/$pkgname.solink.diff
	patch -p1 < $startdir/src/$pkgname.i486i686.diff

	find . -type f -perm 444 | xargs chmod 644

	rm -f Glut.cf
	cp -f linux/Glut.cf .

	./mkmkfiles.imake

	cd lib/glut
	rm -f Makefile
	cp -f ../../linux/Makefile .
	make depend
	make

	cd ../glsmap
	make

	cd ../mui
	make

	cd ../../man
	sed s/gle// Imakefile > Imakefile.tmp
	mv -f Imakefile.tmp Imakefile
	xmkmf

	cd $startdir/src/$pkgname-$pkgver
	mkdir -p $startdir/pkg/usr/X11R6/lib
	cp lib/glut/libglut.so.3.7 $startdir/pkg/usr/X11R6/lib
	chmod 755 $startdir/pkg/usr/X11R6/lib/libglut.so.3.7

	cd $startdir/pkg/usr/X11R6/lib
	ln -sf libglut.so.3.7 libglut.so.3
	ln -sf libglut.so.3 libglut.so

	cd $startdir/src/$pkgname-$pkgver
	cp lib/*/lib*.a $startdir/pkg/usr/X11R6/lib
	rm include/GL/tube.h

	mkdir -p $startdir/pkg/usr/X11R6/include
	cp -a include/* $startdir/pkg/usr/X11R6/include

	cd man
	make DESTDIR=$startdir/pkg MANDIR=/usr/X11R6/man/man3 install.man

	cd $startdir/pkg/usr/X11R6/man/man3
	for file in *.3xglut ; do
		mv $file `basename $file xglut`
	done

	cd $startdir/src/$pkgname-$pkgver
	mkdir -p $startdir/pkg/usr/doc/$pkgname-$pkgver
	cp	-a		\
		FAQ.glut	\
		NOTICE		\
		README*		\
	$startdir/pkg/usr/doc/$pkgname-$pkgver

	find $startdir/pkg/usr/X11R6/man -perm 444 -exec chmod 644 {} \;

}
